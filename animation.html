<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel to Email Automation</title>
    <style>
        :root {
            --background-start: #1e3c72;
            --background-end: #2a5298;
            --excel-green: #217346;
            --envelope-color: #f0f0f0;
            --text-dark: #333;
            --text-light: #fff;
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--background-start) 0%, var(--background-end) 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .automation-container {
            position: relative;
            width: 650px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--text-light);
            border: 1px solid #ccc;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        /* --- Excel Sheet Styling --- */
        .excel-sheet {
            border-collapse: collapse;
            width: 90%;
            table-layout: fixed;
            z-index: 10; /* Above the clones */
            opacity: 1; /* Start fully opaque */
            transition: opacity 1s ease-out; /* Add opacity transition */
        }

        .excel-sheet.fade-out {
            opacity: 0;
        }

        .excel-sheet th, .excel-sheet td {
            border: 1px solid #ddd;
            padding: 10px 15px;
            text-align: left;
            font-size: 14px;
            white-space: nowrap;
            transition: background-color 1s ease-out, border-color 1s ease-out; /* Only background/border fade */
            box-sizing: border-box;
        }

        .excel-sheet th {
            background-color: var(--excel-green);
            color: var(--text-light);
            font-weight: bold;
        }
        
        .excel-sheet td {
            color: var(--text-dark);
            background-color: #fff;
        }

        /* --- Animated Elements --- */
        .data-row-clone {
            position: absolute;
            display: flex;
            align-items: center; /* Align content vertically */
            font-size: 14px;
            z-index: 11; /* Above excel sheet once it fades */
            opacity: 1; /* Always visible initially, covered by excel sheet */
            /* Only transform transition here, opacity will be controlled by JS */
            transition: transform 1.2s cubic-bezier(0.6, -0.28, 0.74, 0.05); 
        }

        .data-row-clone > div {
            padding: 10px 15px;
            white-space: nowrap;
            color: var(--text-dark);
            box-sizing: border-box; /* CRITICAL for perfect alignment */
        }

        .envelope {
            position: absolute;
            width: 80px;
            height: 50px;
            background-color: var(--envelope-color);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 15;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            overflow: hidden;
        }
        
        .envelope.visible {
            opacity: 1;
            transform: scale(1);
        }

        .envelope::before { /* Top flap (inverted triangle) */
            content: '';
            position: absolute;
            top: 0; /* Position at the top of the envelope */
            left: 0;
            width: 0; /* Use border trick for triangle */
            height: 0;
            border-left: 40px solid transparent;
            border-right: 40px solid transparent;
            border-top: 25px solid #e0e0e0;
            transform-origin: top center; /* Rotate from the top edge */
            transition: transform 0.4s ease-in-out 0.1s;
            z-index: 2;
        }
        
        .envelope::after { /* Inner opening part */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 10px;
            background-color: #f8f8f8;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .envelope.open::before { transform: rotateX(180deg); }
        .envelope.open::after { opacity: 1; }
        .envelope.launched { transition: transform 2s ease-in, opacity 2s ease-in; }

        #envelope1 { top: 15%; left: 15%; }
        #envelope2 { top: 15%; right: 15%; }
        #envelope3 { bottom: 15%; left: 15%; }
        #envelope4 { bottom: 15%; right: 15%; }
        #envelope5 { top: 50%; left: 50%; transform: translate(-50%, -50%); }

    </style>
</head>
<body>
    <div class="automation-container">
        <table class="excel-sheet">
            <thead>
                <tr><th>Email</th><th>Name</th><th>Subject</th></tr>
            </thead>
            <tbody>
                <tr><td>john@example.com</td><td>J. Doe</td><td>Order #123</td></tr>
                <tr><td>jane@example.com</td><td>J. Smith</td><td>Invoice</td></tr>
                <tr><td>peter@example.com</td><td>P. Jones</td><td>Confirmed</td></tr>
                <tr><td>anna@example.com</td><td>A. Williams</td><td>Update</td></tr>
                <tr><td>sam@example.com</td><td>S. Brown</td><td>Welcome</td></tr>
            </tbody>
        </table>
        <div id="animation-layer"></div>
        <div class="envelope" id="envelope1"></div>
        <div class="envelope" id="envelope2"></div>
        <div class="envelope" id="envelope3"></div>
        <div class="envelope" id="envelope4"></div>
        <div class="envelope" id="envelope5"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const container = document.querySelector('.automation-container');
        const tableRows = Array.from(document.querySelectorAll('.excel-sheet tbody tr'));
        const envelopes = Array.from(document.querySelectorAll('.envelope'));
        const animationLayer = document.getElementById('animation-layer');
        const clones = [];

        function prepareClones() {
            const containerRect = container.getBoundingClientRect();

            tableRows.forEach(row => {
                const rowRect = row.getBoundingClientRect();
                const clone = document.createElement('div');
                clone.classList.add('data-row-clone');
                
                Array.from(row.children).forEach(cell => {
                    const cellClone = document.createElement('div');
                    cellClone.textContent = cell.textContent;
                    cellClone.style.width = `${cell.getBoundingClientRect().width}px`;
                    clone.appendChild(cellClone);
                });

                clone.style.left = `${rowRect.left - containerRect.left}px`;
                clone.style.top = `${rowRect.top - containerRect.top}px`;
                
                animationLayer.appendChild(clone);
                clones.push(clone);
            });
        }

        async function startAnimation() {
            envelopes.forEach(e => e.classList.add('visible'));

            // Fade out the entire original Excel sheet
            const excelSheet = document.querySelector('.excel-sheet');
            excelSheet.classList.add('fade-out');

            // Wait for excel sheet to fade out, revealing the clones underneath
            await new Promise(resolve => setTimeout(resolve, 1200));

            // Animate clones to envelopes
            await animateClonesToEnvelopes();

            // Launch envelopes
            await new Promise(resolve => setTimeout(resolve, 300));
            launchEnvelopes();
        }

        function animateClonesToEnvelopes() {
            const containerRect = container.getBoundingClientRect();
            const promises = clones.map((clone, index) => {
                return new Promise(resolve => {
                    const targetEnvelope = envelopes[index];
                    const targetRect = targetEnvelope.getBoundingClientRect();
                    const cloneRect = clone.getBoundingClientRect();

                    // Stagger the start of each animation
                    setTimeout(() => {
                        // Force reflow to ensure initial state is rendered
                        clone.offsetHeight; 

                        const targetX = targetRect.left - containerRect.left + (targetRect.width / 2) - (cloneRect.width / 2);
                        const targetY = targetRect.top - containerRect.top + (targetRect.height / 2) - (cloneRect.height / 2);

                        // Apply transform immediately
                        clone.style.transform = `translate(${targetX - clone.offsetLeft}px, ${targetY - clone.offsetTop}px) scale(0.1)`;

                        // After a short delay, start fading out
                        setTimeout(() => {
                            clone.style.opacity = 0;
                        }, 800); // Start fading after 0.8s of movement

                        clone.addEventListener('transitionend', (event) => {
                            // Ensure we only listen for the transform transition end
                            if (event.propertyName === 'transform') {
                                targetEnvelope.classList.add('open');
                                setTimeout(() => {
                                    targetEnvelope.classList.remove('open');
                                    clone.remove();
                                    resolve();
                                }, 400);
                            }
                        }, { once: true });
                    }, index * 150);
                });
            });
            return Promise.all(promises);
        }

        function launchEnvelopes() {
            envelopes.forEach(envelope => {
                envelope.classList.add('launched');
                const angle = (Math.random() - 0.5) * 2 * Math.PI;
                const distance = Math.max(window.innerWidth, window.innerHeight);
                const translateX = Math.cos(angle) * distance;
                const translateY = Math.sin(angle) * distance;
                envelope.style.transform = `translate(${translateX}px, ${translateY}px) rotate(${Math.random() * 720 - 360}deg)`;
                envelope.style.opacity = 0;
            });
        }

        prepareClones();
        setTimeout(startAnimation, 1500);
    });
    </script>
</body>
</html>